<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-frameset-thymeleaf-spring3-3.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=620px,initial-scale=1,target-densitydpi=device-dpi,minimum-scale=1,maximum-scale=1,user-scalable=1" />  
    <meta name="product" content="Metro UI CSS Framework">
    <meta name="description" content="Simple responsive css framework">

    <link th:href="@{/css/metro-bootstrap.css}" rel="stylesheet">
    <link th:href="@{/css/metro-bootstrap-responsive.css}" rel="stylesheet">
    <link th:href="@{/css/iconFont.css}" rel="stylesheet">
    <link th:href="@{/css/docs.css}" rel="stylesheet">
    <link th:href="@{/css/custom.css}" rel="stylesheet">
    <link th:href="@{/js/prettify/prettify.css}" rel="stylesheet">
	<link rel="stylesheet" th:href="@{/zang/bootstrap-3.3.2-dist/css/bootstrap.min.css}"></link>
	<link rel="stylesheet" th:href="@{/zang/css/index.css}" type="text/css" media="screen"></link>

    <!-- Load JavaScript Libraries -->
    <script th:src="@{/js/jquery/jquery.min.js}"></script>
    <script th:src="@{/js/jquery/jquery.widget.min.js}"></script>
    <script th:src="@{/js/jquery/jquery.mousewheel.js}"></script>
    <script th:src="@{/js/prettify/prettify.js}"></script>
    <script th:src="@{/js/holder/holder.js}"></script>
	<script type="text/javascript" th:src="@{/zang/js/jquery.js}"></script>
	<script type="text/javascript" th:src="@{/zang/js/tendina.js}"></script>
	<script type="text/javascript" th:src="@{/zang/js/common.js}"></script>
	<script type="text/javascript" th:src="@{/zang/bootstrap-3.3.2-dist/js/bootstrap.min.js}"></script>

    <!-- Metro UI CSS JavaScript plugins -->
    <script th:src="@{/js/load-metro.js}"></script>
    <script th:src="@{/js/common.js}"></script>

    <!-- Local JavaScript -->

    <title>居委会</title>
</head>
<body class="metro">


    <div class="container">
        <h1>
            <a th:href="@{/login/committee}"><i class="icon-arrow-left-3 fg-darker smaller"></i></a>
              居委干部职位和分工<small class="on-right"></small>
        </h1>

<!--         <p class="description">
                      下为本社区居委会干部，单击人物相片，进行留言操作
        </p>
 -->        <div class="person-list">

            <div style="margin-top: 20px" class="person-list-container">
            </div>
        </div>

        <h3>社区民警以及社区工作人员</h3>
        <div class="container">
            <div class="row">
                <div class="pritem police">
                    <span class="prtitle">社区民警: </span><a class="prname" >黄艳萍</a>
                </div>
            </div>
            <div class="row">
                <div class="pritem zhucan">
                    <span class="prtitle">助残员: </span><a class="prname" >黄艳萍</a>
                </div>
            </div>
        </div>


    </div> <!-- End of container -->
    
	<!-- 模态框（Modal） -->
	<div class="modal fade" id="myModal" tabindex="-1" role="dialog" 
	   aria-labelledby="myModalLabel" aria-hidden="true">
	   <div class="modal-dialog">
		  <div class="modal-content">
			 <div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" 
				   aria-hidden="true">×
				</button>
				<h4 id="sendto" class="modal-title" id="myModalLabel"></h4>
				<input id="to" type="hidden"></input>
			 </div>
			 <div class="modal-body"><textarea id="cont" class="form-control" placeholder="快问候一下吧~"></textarea></div>
			 <div class="modal-footer">
				<button type="button" class="btn btn-default" 
				   data-dismiss="modal">取消</button>
				<button id="send" type="button" class="btn btn-primary">发送</button>
			 </div>
		  </div><!-- /.modal-content -->
	   </div><!-- /.modal-dialog -->
	</div><!-- /.modal -->

    <script th:src="@{/js/hitua.js}"></script>
    <script type="text/javascript">
    if (!String.prototype.format) {
      String.prototype.format = function() {
        var args = arguments;
        return this.replace(/{(\d+)}/g, function(match, number) { 
          return typeof args[number] != 'undefined'
            ? args[number]
            : match
          ;
        });
      };
    }
    
    var userPositionUrl = getUrl("resident/user_position");
    (function($){
        $.ajax({
            type: "GET",
            url: getUrl('rest/managementCitizens/committee'),
            success: function(data) {
                var users = [];
                $(data).each(function(i, d) {
                    for (var r in d.roles) {
                        users.push({userid: d.id, username: d.name, role: d.roles[r], imageUrl: d.image});
                    }
                });
                var police = $(users).filter(function(i,d) {return d.role.name.includes('民警');})[0];
                var zhucan = $(users).filter(function(i,d) {return d.role.name.includes('助残员');})[0];

                $(users).each(function(ind, el) {
                    if (el.userid == police.userid || el.userid == zhucan.userid) {
                        return;
                    }
                    var userid = el.userid;
                    var name = el.username;
                    var position = el.role.name;
                    var html = 
                        '<div class="image-container shadow">' +
                        '<a  href="{0}"><img src="{1}" class=""></a>'.format(userPositionUrl + '?user_id={0}&role_id={1}&back_url={2}'.format(el.userid, el.role.id, 'committee'), 
                        		getUrl('images/' + el.imageUrl)) +
                            '<div class="overlay">' +
                            	'<input id="sendtoid" type="hidden">{0}</input>'.format(userid) +
                                '<span class="name-text">{0}</span><br>'.format(name) +
                                '<span class="position-text">{0}</span>'.format(position) +
                            '</div>' +
                        '</div>';
                    $('.person-list-container').append($(html));
                });

                $('.police .prname').text(police.username);
                $('.zhucan .prname').text(zhucan.username);
                $('.police .prname').attr('href', userPositionUrl + '?user_id={0}&role_id={1}'.format(police.userid, police.role.id))
                $('.zhucan .prname').attr('href', userPositionUrl + '?user_id={0}&role_id={1}'.format(zhucan.userid, zhucan.role.id))

            },
            error: function(obj) {
                console.log(obj);
            }
        });
        })(jQuery);
    </script>

</body>
</html>